<div align="center">
  <img src="./doc/img/LOGO.png" alt="Logo" width="150">
  <h1 align="center">SatelliteConsensus </h1>
</div>

This codebase implements Byzantine fault-tolerant (BFT) consensus algorithms for inter-satellite coordination. We have implemented two Byzantine fault-tolerant consensus protocols: PBFT and HotStuff. 

The HotStuff protocol has two variants: 
- Using threshold signatures
- A version where the leader aggregates followers' signatures into a single packet

This code has been deployed on BUPT-2 and BUPT-3 satellites.

Copyright 2024-2025, Liu Shuo, MIT License

## How to Use the SatelliteConsensus

### Hardware Information
The code has been deployed on:
- BUPT-2 Satellite (Unit A & B)
- BUPT-3 Satellite (Unit A & B)

For details, see:  
[Tiansuan Constellation Introduction](http://www.tiansuan.org.cn/sate-b1.html)  
[Prof. Wang Shangguang's Presentation](http://www.tiansuan.org.cn/source/%E5%A4%A9%E7%AE%97%E6%98%9F%E5%BA%A7%E5%8F%8A%E8%81%94%E7%9B%9F%E4%BB%8B%E7%BB%8D.pdf)

### Compilation
OS: BUPT's [RROS](https://github.com/BUPT-OS/RROS)  
Each consensus directory contains a `Makefile`:
```bash
make clean
make
```

At the same time, each consensus directory has a `run.sh` file, which can also be run to compile.

**Note:** HotStuff-thres requires [MIRACL](https://github.com/miracl), the need to generate `BN254` curve corresponding `core.a` file.


After the compilation is complete, the corresponding consensus executable is generated. The executable file generated by PBFT consensus is named `pbft`, and the executable file name generated by both HotStuff is `hotstuff`.

## Quick Start
Consensus protocols share similar execution steps. The following example uses 4 nodes.

First step: set IP.

The strings 1-4 in the array `ADDRs` represent the IP addresses of consensus nodes 1-4 respectively.
```
char ADDRs[4][16] = {
	"127.0.0.1",
	"127.0.0.1",
	"127.0.0.1",
	"127.0.0.1"
};
```

Second step: set the port number.

The strings 1-4 in the array `PORTs` represent the IP port numbers of consensus nodes 1-4.
```
int PORTs[4] = {100,101,102,103};
```

Third step: set the output path.

The strings 1-4 in the array `FILE_PATH` represent the directories where the result output from consensus nodes 1-4 is located, respectively.
```
char FILE_PATH[4][50] = {
	"./Data_pbft_01.txt",
	"./Data_pbft_02.txt",
	"./Data_pbft_03.txt",
	"./Data_pbft_04.txt"
};
```

Fourth step: run the consensus.

The consensus operation must be performed on nodes 1-4.
The running instructions are shown below
```
./<consensus> <Block_arr> <ID> <Debug_flag> <Run_times> <Arr_num> <Single_block>
```

- `<consensus>` indicates the corresponding consensus executable.
- `<Block_arr>` To test the consensus performance under different sizes of consensus proposals, we provide two lists of consensus proposals of varying sizes. This variable is used to switch between different arrays by toggling between 0 and 1. 
- `<ID>` indicates the identity of the consensus node. 
- `<Debug_flag>` indicates whether the debug mode is enabled. In this mode, many control information will be output. 1 indicates enabled, 0 indicates disabled. 
- `<Run_times>` indicates the number of times a consensus proposal is run for each size.
- `<Arr_num>` indicates how many consensus proposals in `<Block_arr>` are tested, 0 indicates that we do not provide the array, 12 is the maximum.
- `<Single_block>` indicates the size of the consensus proposal in addition to the above array, with a run count of `<Run_times>`.


PBFT example:
```
./pbft 1 1 0 50 12 524288
./pbft 1 2 0 50 12 524288
./pbft 1 3 0 50 12 524288
./pbft 1 4 0 50 12 524288
```

## Acknowledgments
We gratefully acknowledge the Beijing University of Posts and Telecommunications (BUPT) for providing the BUPT-2 and BUPT-3 satellites, which enable the deployment of our consensus protocols.


**Thank you for your interest in our work!**
